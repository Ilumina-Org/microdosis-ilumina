---
import { content_v2_1 } from "googleapis";
import Layout from "../layouts/Layout.astro";
import { getProducts } from "../utils/stock";
import ProductContainer from "./ReactComponents/ProductContainer";

let products = [];
let errorMessage = "";

try {
  products = await getProducts();
  products = products.slice(0, 3);
} catch (error) {
  errorMessage = "Hubo un problema al cargar los productos. Intenta m√°s tarde.";
}

console.log("productos", products);
---

<Layout>
  <section
    id="products"
    class="container"
    style={{
      display: "flex",
      flexDirection: "column",
      height: "100vh",
      justifyContent: "center",
    }}
  >
    <div style={{ width: "100%", textAlign: "left" }}>
      <h2 style={{ fontWeight: 300, fontSize: "35px", color: "black" }}>
        Paquetes Disponibles
      </h2>
    </div>

    <div
      style={{
        display: "flex",
        justifyContent: "center",
        alignContent: "center",
        gap: "30px",
        flexWrap: "wrap",
      }}
    >
      {
        errorMessage && (
          <p style={{ color: "red", fontSize: "18px" }}>{errorMessage}</p>
        )
      }

      {
        !errorMessage && products.length === 0 && (
          <p style={{ fontSize: "18px" }}>No hay productos disponibles.</p>
        )
      }

      {
        products.map((product) => (
          <ProductContainer
            client:load
            key={product.sku}
            imageUrl={`/public/products/${product.sku}-card.svg`}
            sku={product.sku}
            productTitle={product.title}
            productDetail={product.productDetail}
            productPrice={product.productPrice}
            productDeal={product.productDeal}
            tier={product.tier}
            stock={product.stock}
            tipo={product.tipo}
          />
        ))
      }
    </div>
  </section>
</Layout>

<style>
  .container {
    --horizontalPadding: 10rem;
    background: white;
    padding: 2rem;
    padding-right: var(--horizontalPadding);
    padding-left: var(--horizontalPadding);
    scroll-snap-align: start;
  }

  @media (max-width: 768px) {
    #container {
      --horizontalPadding: 2rem;
      padding: 1rem;
    }
  }
</style>

import{j as n}from"./jsx-runtime.D_zvdyIk.js";import{r as u,R as P}from"./index.ai7qpRr1.js";/* empty css                       */var x={},S;function I(){if(S)return x;S=1,Object.defineProperty(x,"__esModule",{value:!0}),x.loadMercadoPago=void 0;const c="https://sdk.mercadopago.com/js/v2",r=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,a="MercadoPago has already been initialized in your window, please remove the duplicate import",o="MercadoPago.js not available",l="Failed to load MercadoPago.js",t=()=>{for(var i=document.querySelectorAll(`script[src^="${c}"`),e=0;e<i.length;e++){var s=i[e];if(r.test(s.src))return s}return null},d=()=>{const i=document.createElement("script");i.src=c;const e=document.head||document.body;if(!e)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return e.appendChild(i),i};let f=null;const h=()=>(f!==null||(f=new Promise((i,e)=>{if(typeof window>"u"){i(null);return}if(window.MercadoPago){console.warn(a),i(window.MercadoPago);return}try{let s=t();s?console.warn(a):s||(s=d()),s.addEventListener("load",()=>{window.MercadoPago?i(window.MercadoPago):e(new Error(o))}),s.addEventListener("error",()=>{e(new Error(l))})}catch(s){e(s);return}})),f);return x.loadMercadoPago=h,x}var O=I(),k=function(c,r,a,o){function l(t){return t instanceof a?t:new a(function(d){d(t)})}return new(a||(a=Promise))(function(t,d){function f(e){try{i(o.next(e))}catch(s){d(s)}}function h(e){try{i(o.throw(e))}catch(s){d(s)}}function i(e){e.done?t(e.value):l(e.value).then(f,h)}i((o=o.apply(c,r||[])).next())})};class m{static getInstance(){return k(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield O.loadMercadoPago(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}m.publicKey=null;m.options={};m.instanceMercadoPago=void 0;m.loadedInstanceMercadoPago=!1;function A(c,r){return Object.keys(c).length===Object.keys(r).length&&Object.keys(c).every(o=>Object.prototype.hasOwnProperty.call(r,o)&&c[o]===r[o])}const D=(c,r)=>{const a=Object.assign(Object.assign({},r),{frontEndStack:"react"}),o=!A(m.options,a);(c!==m.publicKey||o)&&(m.publicKey=c,m.options=a,m.instanceMercadoPago=void 0)},R=200;var T=function(c,r,a,o){function l(t){return t instanceof a?t:new a(function(d){d(t)})}return new(a||(a=Promise))(function(t,d){function f(e){try{i(o.next(e))}catch(s){d(s)}}function h(e){try{i(o.throw(e))}catch(s){d(s)}}function i(e){e.done?t(e.value):l(e.value).then(f,h)}i((o=o.apply(c,r||[])).next())})};const L=()=>T(void 0,void 0,void 0,function*(){}),B=()=>{},$=c=>{console.error(c)};var K=function(c,r,a,o){function l(t){return t instanceof a?t:new a(function(d){d(t)})}return new(a||(a=Promise))(function(t,d){function f(e){try{i(o.next(e))}catch(s){d(s)}}function h(e){try{i(o.throw(e))}catch(s){d(s)}}function i(e){e.done?t(e.value):l(e.value).then(f,h)}i((o=o.apply(c,r||[])).next())})};const q=({settings:c,name:r,containerId:a,controller:o})=>K(void 0,void 0,void 0,function*(){const l=yield m.getInstance(),t=l?.bricks();window[o]=yield t?.create(r,a,c)}),G=({onReady:c=B,onError:r=$,onSubmit:a=L,customization:o,initialization:l,brand:t,locale:d,id:f="walletBrick_container"})=>(u.useEffect(()=>{const h={settings:{brand:t,initialization:l,customization:o,locale:d,callbacks:{onReady:c,onSubmit:a,onError:r}},name:"wallet",containerId:f,controller:"walletBrickController"},i=setTimeout(()=>{q(h)},R);return()=>{var e;clearTimeout(i),(e=window.walletBrickController)===null||e===void 0||e.unmount()}},[o,l,c,r,a]),P.createElement("div",{id:f})),U=({product_data:c})=>{const[r,a]=u.useState(null),[o,l]=u.useState(!0),[t,d]=u.useState(null),f=u.useRef(!1);return u.useEffect(()=>{const h=new AbortController;let i=!0;return(async()=>{try{f.current||(D("APP_USR-76bfa056-51e9-4858-a632-fca8fab5a7f5",{locale:"es-PE"}),f.current=!0);const j=await(await fetch("/api/create-preference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),signal:h.signal})).json();if(!j.id)throw new Error("Error al crear preferencia");i&&a(j.id)}catch(s){i&&!h.signal.aborted&&d(s instanceof Error?s.message:"Error desconocido")}finally{i&&l(!1)}})(),()=>{i=!1,h.abort()}},[c]),o?n.jsx("div",{children:"Cargando pasarela de pago..."}):t?n.jsxs("div",{children:["Error: ",t]}):n.jsx("div",{className:"mercado-pago-container",children:r&&n.jsx(G,{initialization:{preferenceId:r}})})},J=({basePrice:c,title:r,packageId:a})=>{const[o,l]=u.useState([]),[t,d]=u.useState(""),[f,h]=u.useState(c),[i,e]=u.useState(!1),[s,j]=u.useState(0),[F,b]=u.useState(""),[w,M]=u.useState("mercadopago-option"),[X,C]=u.useState(0),v=u.useRef({price:0,district:"",instance:null});u.useEffect(()=>{t||C(p=>p+1)},[t]),u.useEffect(()=>{(async()=>{try{const E=await(await fetch("/api/districts")).json();l(E)}catch{b("Error cargando los distritos")}})()},[]),u.useEffect(()=>{const p=new AbortController;return(async()=>{if(t){e(!0);try{const _=await(await fetch(`/api/calculate-shipping?district=${t}&packageId=${a}`,{signal:p.signal})).json();if(_.success){j(_.shippingCost);const y=c+_.shippingCost;h(y),(y!==v.current.price||t!==v.current.district)&&(v.current={price:y,district:t,instance:n.jsx(U,{product_data:{price:y,name:r,quantity:1,district:t}},`${y}-${t}`)})}}catch{p.signal.aborted||b("Error calculando el env√≠o")}finally{p.signal.aborted||e(!1)}}})(),()=>p.abort()},[t,a,c,r]);const g=p=>{M(N=>N===p?null:p)};return n.jsxs("div",{className:"payment-section",children:[n.jsx("h2",{children:"M√©todo de Pago"}),n.jsxs("div",{className:"shipping-selector",children:[n.jsx("label",{children:"Distrito de entrega:"}),n.jsxs("select",{value:t,onChange:p=>d(p.target.value),disabled:i,children:[n.jsx("option",{value:"",children:"Seleccione su distrito"}),o.map(p=>n.jsx("option",{value:p.code,children:p.name},p.code))]}),i&&n.jsx("span",{className:"loading",children:"Calculando env√≠o..."}),s>0&&!i&&n.jsxs("div",{className:"shipping-cost",children:["Costo de env√≠o: S/ ",s.toFixed(2)]})]}),n.jsxs("div",{className:"payment-options",children:[n.jsxs("div",{className:`payment-option ${w==="mercadopago-option"?"active":""}`,children:[n.jsxs("div",{className:"payment-option-header",onClick:()=>g("mercadopago-option"),children:[n.jsx("span",{className:"payment-icon",children:"üü°"}),n.jsx("span",{className:"payment-title",children:"Mercado Pago"}),n.jsx("div",{className:"payment-badge",children:"Recomendado"}),n.jsx("span",{className:"toggle-icon",children:"‚ñº"})]}),n.jsx("div",{className:"payment-option-content",children:n.jsxs("div",{className:"mercado-pago-details",children:[n.jsx("p",{className:"payment-description",children:"Paga con tarjeta, efectivo o saldo de Mercado Pago"}),n.jsxs("div",{className:"payment-methods-grid",children:[n.jsx("span",{className:"method-icon",children:"üí≥"}),n.jsx("span",{className:"method-icon",children:"üì±"}),n.jsx("span",{className:"method-icon",children:"üíµ"})]}),t&&v.current.instance,n.jsxs("div",{className:"security-info",children:[n.jsx("span",{className:"lock-icon",children:"üîí"}),n.jsx("span",{children:"Transacci√≥n 100% segura"})]})]})})]}),n.jsxs("div",{className:`payment-option ${w==="card-option"?"active":""}`,children:[n.jsxs("div",{className:"payment-option-header",onClick:()=>g("card-option"),children:[n.jsx("span",{className:"payment-icon",children:"üí≥"}),n.jsx("span",{className:"payment-title",children:"Tarjeta de D√©bito/Cr√©dito"}),n.jsx("span",{className:"toggle-icon",children:"‚ñº"})]}),n.jsx("div",{className:"payment-option-content",children:n.jsx("p",{className:"coming-soon",children:"Pr√≥ximamente: Estamos trabajando en la integraci√≥n segura de tarjetas"})})]}),n.jsxs("div",{className:`payment-option ${w==="culqi-option"?"active":""}`,children:[n.jsxs("div",{className:"payment-option-header",onClick:()=>g("culqi-option"),children:[n.jsx("span",{className:"payment-icon",children:"‚ö°"}),n.jsx("span",{className:"payment-title",children:"Culqi"}),n.jsx("span",{className:"toggle-icon",children:"‚ñº"})]}),n.jsx("div",{className:"payment-option-content",children:n.jsx("p",{className:"coming-soon",children:"Integraci√≥n con Culqi en desarrollo"})})]}),n.jsxs("div",{className:`payment-option ${w==="transfer-option"?"active":""}`,children:[n.jsxs("div",{className:"payment-option-header",onClick:()=>g("transfer-option"),children:[n.jsx("span",{className:"payment-icon",children:"üè¶"}),n.jsx("span",{className:"payment-title",children:"Transferencia Bancaria"}),n.jsx("span",{className:"toggle-icon",children:"‚ñº"})]}),n.jsx("div",{className:"payment-option-content",children:n.jsxs("div",{className:"bank-transfer-details",children:[n.jsxs("div",{className:"bank-info-item",children:[n.jsx("span",{className:"info-label",children:"Banco:"}),n.jsx("span",{className:"info-value",children:"Banco Nacional"})]}),n.jsxs("div",{className:"bank-info-item",children:[n.jsx("span",{className:"info-label",children:"Titular:"}),n.jsx("span",{className:"info-value",children:"Microdosis Ilumina S.A."})]}),n.jsxs("div",{className:"bank-info-item",children:[n.jsx("span",{className:"info-label",children:"CBU/CVU:"}),n.jsx("span",{className:"info-value highlight",children:"0000000000000000000000"})]}),n.jsxs("div",{className:"bank-info-item",children:[n.jsx("span",{className:"info-label",children:"ALIAS:"}),n.jsx("span",{className:"info-value highlight",children:"MICRODOSIS.ILUMINA"})]}),n.jsx("button",{className:"contact-button",children:"üì© Enviar Comprobante"})]})})]})]})]})};export{J as default};
